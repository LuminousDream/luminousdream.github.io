<!DOCTYPE html>


<html class="use-lxgw_wk banner-as-cover article-header-style-2">
<head>
	
	<title>都市看客暗梦 の 浅谈曾经在 Linux 遇到的 OOM 机制 - FantasyLand の 暗梦</title>
	<meta charset="utf-8">
	
		<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
	
	<meta name="description" content="First. 前言Hi，各位旅行者们，你们好，I’m 暗梦，在个人博客的运行过程中，我们有时，或许会出现因为内存不足而造成 OOM 机制 [OOM (Out Of Memory) Killer]，然而造成这种现象的主要原因嘛，还是来讲暗梦我以前 (Tip: 大概是 2 年前博客还没有迁移到 Github 之前) 在国内的云服务器遇到的：  服务器所运行的 MySQL &amp; PHP 占用内存过">
<meta property="og:type" content="article">
<meta property="og:title" content="都市看客暗梦 の 浅谈曾经在 Linux 遇到的 OOM 机制">
<meta property="og:url" content="https://anmeng.asia/d5bff76b/index.html">
<meta property="og:site_name" content="FantasyLand の 暗梦">
<meta property="og:description" content="First. 前言Hi，各位旅行者们，你们好，I’m 暗梦，在个人博客的运行过程中，我们有时，或许会出现因为内存不足而造成 OOM 机制 [OOM (Out Of Memory) Killer]，然而造成这种现象的主要原因嘛，还是来讲暗梦我以前 (Tip: 大概是 2 年前博客还没有迁移到 Github 之前) 在国内的云服务器遇到的：  服务器所运行的 MySQL &amp; PHP 占用内存过">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2023-10-23T13:12:55.000Z">
<meta property="article:modified_time" content="2024-02-02T17:05:27.000Z">
<meta property="article:author" content="暗梦先生呀~">
<meta property="article:tag" content="Linux">
<meta name="twitter:card" content="summary">
	
	<meta name="theme-color" content="#F05B85">
	<meta name="theme-color-rgb" content="240,91,133">
	<meta name="theme-color-origin" content="#F05B85">
	<meta name="argon-enable-custom-theme-color" content="true">
	<meta name="theme-card-radius" content="15">
	<meta name="theme-version" content="1.0.2">
	<link rel="icon" href="/favicon.ico" type="image/x-icon">
	<link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
	<script src="/assets/vendor/mdui/mdui.min.js"></script>
    <script src="/assets/vendor/sweetalert/sweetalert.min.js"></script>
	<script src="/assets/vendor/marked/marked.min.js"></script>
	<script src="/assets/js/APlayer.min.js"></script>
	<link rel="stylesheet" href="/assets/css/APlayer.min.css" />
	<script src="/assets/vendor/echarts/echarts.min.js"></script>
	<link rel="stylesheet" href="/assets/css/twikoo.anmeng.css"/>
	<link rel="stylesheet" href="https://npm.elemecdn.com/lxgw-wenkai-webfont@1.7.0/style.css">
	<script src="/assets/js/darkdream_piano.js"></script>
	<script src="/assets/js/ff_clock.js"></script>
	<script src="/assets/js/darkdream_blog.js"></script>
	<script src="/assets/js/darkdream_roman_clock.js"></script>
	<script src="/assets/js/calendar.js"></script>
	<script src="/assets/js/echarts.min.js"></script>
	<script src="/assets/vendor/twikoo/twikoo.all.anmeng.min.js"></script>
	
		<script async src="/assets/js/darkdream_blog_fps.js"></script>
	
	<div id="fps"></div>
	<style id="fancybox-style-noscroll" type="text/css">
		.compensate-for-scrollbar{
			margin-right:15px;
		}
	</style>
	
<link rel="stylesheet" href="/assets/vendor/mdui/mdui.min.css">

	
<link rel="stylesheet" href="/assets/argon_css_merged.css">

	
<link rel="stylesheet" href="/style.css">

	
<link rel="stylesheet" href="//fonts.googleapis.com/css?family=Open+Sans:300,400,600,700|Noto+Serif+SC:300,600&display=swap.css">

	
<script src="/assets/argon_js_merged.js"></script>

	
<script src="/assets/js/argon.min.js"></script>


	
	

	<script>
		var argonConfig = {
			language: "zh_CN",
			
				zoomify: false,
			
			
				fancybox: {},
			
			pangu: "false",
			
				lazyload: false,
			
			disable_pjax: false,
			headroom: false,
			
				waterflow_columns: "2and3"
			
		}

		
		
		
		var anmeng_blog_config = {
			twikoo: {
				twikoo_url: "https://twikoo.anmeng.asia"
			},
			blog_last_update_time: "2024-08-07"
		};
	</script>
	<script no-pjax="">
	function yearprogress_refresh(){
		let year = new Date().getFullYear();
		$("#yearprogress_yearname").text(year);
		let from = new Date(year, 0, 1, 0, 0, 0);
		let to = new Date(year, 11, 31, 23, 59, 59);
		let now = new Date();
		let progress = ((now - from) / (to - from + 1) * 100).toFixed(7);
		let progressshort = ((now - from) / (to - from + 1) * 100).toFixed(2);
		$("#yearprogress_progresstext").text(progressshort + "%");
		$("#yearprogress_progresstext_full").text(progress + "%");
		$("#yearprogress_progressbar").css("width" , progress + "%");
	}
		yearprogress_refresh();
		if (typeof(yearProgressIntervalHasSet) == "undefined"){
   		 var yearProgressIntervalHasSet = true;
   		 setInterval(function(){yearprogress_refresh();},500);
	}
</script>
	<script>
		window.addEventListener("scroll", function (e) {
		  if (window.scrollY > window.innerHeight * 0.3) {
		    document.querySelector("#content").classList.add("scrolled");
		  } else {
		    document.querySelector("#content").classList.remove("scrolled");
		  }
		});
	</script>
	<script>
		var darkmodeAutoSwitch = "system";
		
 		function setDarkmode(enable){
			if (enable == true){
				$("html").addClass("darkmode");
			}else{
				$("html").removeClass("darkmode");
			}
			$(window).trigger("scroll");
		}
		function toggleDarkmode(){
			if ($("html").hasClass("darkmode")){
				setDarkmode(false);
				$("#cc_info").removeClass("cc_info_darkmode");
				sessionStorage.setItem("Argon_Enable_Dark_Mode", "false");
			}else{
				setDarkmode(true);
				sessionStorage.setItem("Argon_Enable_Dark_Mode", "true");
				$("#cc_info").addClass("cc_info_darkmode");
			}
		}
		if (sessionStorage.getItem("Argon_Enable_Dark_Mode") == "true"){
			setDarkmode(true);
		}
		function toggleDarkmodeByPrefersColorScheme(media){
			if (sessionStorage.getItem('Argon_Enable_Dark_Mode') == "false" || sessionStorage.getItem('Argon_Enable_Dark_Mode') == "true"){
				return;
			}
			if (media.matches){
				setDarkmode(true);
			}else{
				setDarkmode(false);
			}
		}
		
		if (darkmodeAutoSwitch == 'system'){
			var darkmodeMediaQuery = window.matchMedia("(prefers-color-scheme: dark)");
			darkmodeMediaQuery.addListener(toggleDarkmodeByPrefersColorScheme);
			toggleDarkmodeByPrefersColorScheme(darkmodeMediaQuery);
		}
		
		if (darkmodeAutoSwitch == 'alwayson'){
			setDarkmode(true);
		}

		function toggleAmoledDarkMode(){
			$("html").toggleClass("amoled-dark");
			if ($("html").hasClass("amoled-dark")){
				localStorage.setItem("Argon_Enable_Amoled_Dark_Mode", "true");
			}else{
				localStorage.setItem("Argon_Enable_Amoled_Dark_Mode", "false");
			}
		}
		if (localStorage.getItem("Argon_Enable_Amoled_Dark_Mode") == "true"){
			$("html").addClass("amoled-dark");
		}else if (localStorage.getItem("Argon_Enable_Amoled_Dark_Mode") == "false"){
			$("html").removeClass("amoled-dark");
		}
	</script>
	<script>
		if (navigator.userAgent.indexOf("Safari") !== -1 && navigator.userAgent.indexOf("Chrome") === -1){
			$("html").addClass("using-safari");
		}
	</script>

	
		
<script src="/assets/vendor/smoothscroll/smoothscroll1.js"></script>

	
<meta name="generator" content="Hexo 5.4.2"></head>



<style id="themecolor_css">
	
	:root{
		--themecolor: #F05B85;
		--themecolor-dark0: #EF4F7C;
		--themecolor-dark: #EE4474;
		--themecolor-dark2: #EC2C62;
		--themecolor-dark3: #E91551;
		--themecolor-light: #F48AA8;
		--themecolor-R: 240;
		--themecolor-G: 91;
		--themecolor-B: 133;
		--themecolor-rgbstr: 240,91,133;
		--theme-opacity: .65;
		--themecolor-gradient: linear-gradient(150deg,var(--themecolor-light) 15%, var(--themecolor) 70%, var(--themecolor-dark0) 94%);

	}
</style>
<style id="theme_cardradius_css">
	:root{
		--card-radius: 15px;
	}
</style>
<body>

<div id="toolbar">
	<header class="header-global">
		<nav id="navbar-main" class="navbar navbar-main navbar-expand-lg navbar-transparent navbar-light bg-primary headroom--not-bottom headroom--not-top headroom--pinned">
			<div class="container">
				
				<button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar_global" aria-controls="navbar_global" aria-expanded="false" aria-label="Toggle navigation">
					<span class="navbar-toggler-icon"></span>
				</button>
				<a class="navbar-brand" href="/">FantasyLand の 暗梦</a>
				<div class="navbar-collapse collapse" id="navbar_global">
					<div class="navbar-collapse-header">
						<div class="row">
							<div class="col-6 collapse-brand"></div>
							<div class="col-6 collapse-close">
								<button type="button" class="navbar-toggler" data-toggle="collapse" data-target="#navbar_global" aria-controls="navbar_global" aria-expanded="false" aria-label="Toggle navigation">
									<span></span>
									<span></span>
								</button>
							</div>
						</div>
						&nbsp;
					</div>
					
							<ul class='navbar-nav navbar-nav-hover align-items-lg-center ml-lg-auto"'>
								
										<li class='nav-item'>
											<a href='/' class='nav-link' >
												<i class='ni ni-book-bookmark d-lg-none'></i>
												<span class='nav-link-inner--text'><i class="fa fa-home mr-1"></i>&nbsp;首页</span>
											</a>
											
										</li>
									
										<li class='nav-item'>
											<a href='/shuoshuo' class='nav-link' >
												<i class='ni ni-book-bookmark d-lg-none'></i>
												<span class='nav-link-inner--text'><i class="fa fa-quote-left mr-1"></i>&nbsp;说说</span>
											</a>
											
										</li>
									
										<li class='nav-item'>
											<a href='/archives' class='nav-link' >
												<i class='ni ni-book-bookmark d-lg-none'></i>
												<span class='nav-link-inner--text'><i class="fa fa-archive mr-1"></i>&nbsp;归档</span>
											</a>
											
										</li>
									
										<li class='nav-item'>
											<a href='/liuyanban' class='nav-link' >
												<i class='ni ni-book-bookmark d-lg-none'></i>
												<span class='nav-link-inner--text'><i class="fa fa-comment mr-1"></i>&nbsp;留言板</span>
											</a>
											
										</li>
									
										<li class='nav-item'>
											<a href='/suzaku_links' class='nav-link' >
												<i class='ni ni-book-bookmark d-lg-none'></i>
												<span class='nav-link-inner--text'><i class="fa fa-address-book mr-1"></i>&nbsp;友人账</span>
											</a>
											
										</li>
									
										<li class='nav-item'>
											<a href='/suzaku_piano' class='nav-link' >
												<i class='ni ni-book-bookmark d-lg-none'></i>
												<span class='nav-link-inner--text'><i class="fa fa-music mr-1"></i>&nbsp;暗梦的天空之琴</span>
											</a>
											
										</li>
									
										<li class='nav-item'>
											<a target="_blank" rel="noopener" href='https://www.travellings.cn/go.html' class='nav-link' >
												<i class='ni ni-book-bookmark d-lg-none'></i>
												<span class='nav-link-inner--text'><i class="fa fa-subway mr-1"></i>&nbsp;开往</span>
											</a>
											
										</li>
									
										<li class='nav-item'>
											<a href='/about' class='nav-link' >
												<i class='ni ni-book-bookmark d-lg-none'></i>
												<span class='nav-link-inner--text'><i class="fa fa-user mr-1"></i>&nbsp;关于我</span>
											</a>
											
										</li>
									
							</ul>
						
				
			</div>
			<ul class="navbar-nav align-items-lg-center ml-lg-auto">
				<li id="navbar_search_container" class="nav-item" data-toggle="modal">
					<div id="navbar_search_input_container" class="">
						<div class="input-group input-group-alternative">
							<div class="input-group-prepend">
								<span class="input-group-text"><i class="fa fa-search"></i></span>
							</div>
							<input id="local-search-input" class="form-control" placeholder="搜索文章 & 说说" type="text" autocomplete="off" data-search.path="search.xml" data-config.root="/">
							<div id="local-search-result" class="modal-content"></div>
						</input>
						</div>
					</div>
				</li>
			</ul>

		</nav>
	</header>
</div>

<!--Banner-->
<section id="banner" class="banner section section-lg section-shaped">
	
	<div class="shape shape-style-1 shape-default">
	
	</div>

	
	<div id="banner_container" class="banner-container container text-center">
		<div class="banner-title text-white"><span class="banner-title-inner">FantasyLand の 暗梦</span>
		<script src="/assets/vendor/typed.js/typed.js"></script>
		<span class="banner-subtitle d-block">
			<span id="typed"></span>
		</span>
		<script>
	  		var typed = new Typed('#typed', {
	    		"strings":["Hello，来自异乡的旅行者，I'm 暗梦，你也可以叫我沉默Ace</br>来坐坐吧，让我们来观赏夜空，来回忆曾经的诗与远方。","在都市里一些阴暗的角落中，也有人人心系的梦想<br>但我们仍旧可以保持善良与友爱。","我们看错了这个世界，却说这个世界欺骗了我们。","或许人生没有Ctrl+Z，或者在Mac上的Command+Z，有时候你需要</br>“[root@Your's Life]# reboot ”","有时侯明白人的一生当中，深刻的思念是维系自己与记忆的纽带</br>它维系着所有的过往，悲喜，亦指引我们深入茫茫命途<br>这是我们宿命的背负，但我始终甘之如饴地承受它的沉沉重量，用以平衡轻浮的生。","人最怕的不是失去，而是没有面对失去的勇气</br>人生，得失聚散，坦然处之，得到未必是福，失去未必是祸。","人生如戏，故事如诗。"],"typeSpeed":140,"backSpeed":50,"loop":false,"showCursor":true,cursorChar: ' ✦'
	  		});
			</script>

	</div>
	</div>
	
		<style>
			section.banner{
				background-image: url(/background.jpg) !important;
			}
		</style>
	
	<div class="cover-scroll-down">
		<i class="fa fa-angle-down" id="cover-scroll-down-icon" aria-hidden="true"></i>
	</div>
</section>


	<style>
		#content.scrolled::after,
		#content.scrolled::before {
                   filter: blur(6px);
                   transform: scale(1.02);
		}

		#content:before {
			transition: filter .3s ease, transform .3s ease !important;
			content: '';
			display: block;
			position: fixed;
			left: 0;
			right: 0;
			top: 0;
			bottom: 0;
			z-index: -2;
			background: url(/background.jpg);
			background-position: center;
			background-size: cover;
			background-repeat: no-repeat;
			opacity: 1;
			transition: opacity .5s ease;
		}
		html.darkmode #content:before{
			filter: brightness(0var(--theme-opacity));
		}
		
			#content:after {
				content: '';
				transition: filter .3s ease, transform .3s ease !important;
				display: block;
				position: fixed;
				left: 0;
				right: 0;
				top: 0;
				bottom: 0;
				z-index: -2;
				background: url(/background_darkmode.jpg);
				background-position: center;
				background-size: cover;
				background-repeat: no-repeat;
				opacity: 0;
				transition: opacity .5s ease;
			}
			html.darkmode #content:after {
				opacity: 1;
			}
			html.darkmode #content:before {
				opacity: 0;
			}
		
		
			#banner, #banner .shape {
				background: transparent !important;
			}
		
	</style>



	<style>
		#banner:after {
			content: '';
			width: 100vw;
			position: absolute;
			left: 0;
			top: 0;
			height: 120px;
			background: linear-gradient(180deg, rgba(0,0,0,0.25) 0%, rgba(0,0,0,0.15) 35%, rgba(0,0,0,0) 100%);
			display: block;
			z-index: -1;
		}
		.banner-title {
			text-shadow: 0 5px 15px rgba(0, 0, 0, .2);
		}
	</style>


<div id="float_action_buttons" class="float-action-buttons fabtns-unloaded">
	<button id="fabtn_toggle_sides" class="btn btn-icon btn-neutral fabtn shadow-sm" type="button" aria-hidden="true" tooltip-move-to-left="移至左侧" tooltip-move-to-right="移至右侧">
		<span class="btn-inner--icon fabtn-show-on-right"><i class="fa fa-caret-left"></i></span>
		<span class="btn-inner--icon fabtn-show-on-left"><i class="fa fa-caret-right"></i></span>
	</button>
	<button id="fabtn_back_to_top" class="btn btn-icon btn-neutral fabtn shadow-sm" type="button" style="height: 30px !important;" aria-label="Back To Top" tooltip="回到顶部">
		<span class="btn-inner--icon"><i class="fa fa-angle-up"></i></span>
	</button>
	
	<button id="fabtn_toggle_aplayer" class="btn btn-icon btn-neutral fabtn shadow-sm" type="button" style="height: 30px !important;" tooltip="音乐播放器">
		<span class="btn-inner--icon"><i class="fa fa-music"></i></span>
	</button>
	
	<button id="fabtn_toggle_darkmode" class="btn btn-icon btn-neutral fabtn shadow-sm" type="button" style="height: 30px !important;" <-% theme.fab_show_darkmode_button ? "" : "style='display: none;'  aria-label="Toggle Darkmode" tooltip-darkmode="夜间模式" tooltip-blackmode="暗黑模式" tooltip-lightmode="日间模式">
		<span class="btn-inner--icon"><i class="fa fa-moon-o"></i><i class='fa fa-lightbulb-o'></i></span>
	</button>
	
	<button id="fabtn_goto_randompost" class="btn btn-icon btn-neutral fabtn shadow-sm" type="button" style="height: 30px !important;" aria-label="goto_randompost" tooltip="随机文章">
		<span class="btn-inner--icon"><i class="fa fa-random"></i></span>
	</button>
	
	<button id="fabtn_go_to_comment" class="btn btn-icon btn-neutral fabtn shadow-sm d-none" type="button" style="height: 30px !important;" <-% theme.fab_show_gotocomment_button ? "" : "style='display: none;'"  aria-label="Comment" tooltip="评论">
		<span class="btn-inner--icon"><i class="fa fa-comment-o"></i></span>
	</button>
	<button id="fabtn_toggle_blog_settings_popup" class="btn btn-icon btn-neutral fabtn shadow-sm" type="button" style="height: 30px !important;" <-% theme.fab_show_settings_button ? "" : "style='display: none;'"  aria-label="Open Blog Settings Menu" tooltip="设置">
		<span class="btn-inner--icon"><i class="fa fa-cog"></i></span>
	</button>
	<div id="fabtn_blog_settings_popup" class="card shadow-sm" style="opacity: 0;" aria-hidden="true">
		<div id="close_blog_settings"><i class="fa fa-close"></i></div>
		<div class="blog-setting-item mt-3">
			<div style="transform: translateY(-4px);"><div id="blog_setting_toggle_darkmode_and_amoledarkmode" tooltip-switch-to-darkmode="切换到夜间模式" tooltip-switch-to-blackmode="切换到暗黑模式"><i class="fa fa-moon-o"></i>&nbsp;&nbsp;<span>夜间模式</span><span>暗黑模式</span></div></div>
			<div style="flex: 1;"></div>
			<label id="blog_setting_darkmode_switch" class="custom-toggle">
				<span class="custom-toggle-slider rounded-circle"></span>
			</label>
		</div>
		
		<div class="blog-setting-item mt-3 toggle_readingmode">
			<div style="transform: translateY(-4px);"><div id="blog_setting_toggle_readingmode"><i class="fa fa-book"></i>&nbsp;&nbsp;<span>阅读模式布局 <i>(单栏布局)</i></span></div></div>
			<div style="flex: 1;"></div>
			<label id="blog_setting_readingmode_switch" class="custom-toggle">
				<span class="custom-toggle-slider rounded-circle"></span>
			</label>
		</div>
		
		<div class="blog-setting-item mt-3">
			<div style="flex: 1;"><i class="fa fa-font"></i>&nbsp;&nbsp;字体</div>
			<div>
				<button id="blog_setting_font_sans_serif" type="button" class="blog-setting-font btn btn-outline-primary blog-setting-selector-left">Sans Serif</button><button id="blog_setting_font_serif" type="button" class="blog-setting-font btn btn-outline-primary blog-setting-selector-right">Serif</button>
			</div>
		</div>
		<div class="blog-setting-item mt-3">
			<div style="flex: 1;"></div>
			<div>
				<button id="blog_setting_font_lxgw_wk" type="button" class="blog-setting-font btn btn-outline-primary blog-setting-selector-left">霞鹜文楷</button><button id="blog_setting_font_myzymyqx" type="button" class="blog-setting-font btn btn-outline-primary blog-setting-selector-single">满眼醉意梦屿千寻</button><button id="blog_setting_font_unifont" type="button" class="blog-setting-font btn btn-outline-primary blog-setting-selector-right">GNU Unifont</button>
			</div>
		</div>
		<div class="blog-setting-item mt-3">
			<div style="flex: 1;"><i class="fa fa-clone"></i>&nbsp;&nbsp;阴影</div>
			<div>
				<button id="blog_setting_shadow_small" type="button" class="blog-setting-shadow btn btn-outline-primary blog-setting-selector-left">浅阴影</button><button id="blog_setting_shadow_big" type="button" class="blog-setting-shadow btn btn-outline-primary blog-setting-selector-right">深阴影</button>
			</div>
		</div>
		<div class="blog-setting-item mt-3 mb-3">
			<div style="flex: 1;"><i class="fa fa-desktop"></i>&nbsp;&nbsp;滤镜</div>
			<div id="blog_setting_filters" class="ml-3">
				<button id="blog_setting_filter_off" type="button" class="blog-setting-filter-btn ml-0" filter-name="off">关闭</button>
				<button id="blog_setting_filter_sunset" type="button" class="blog-setting-filter-btn" filter-name="sunset">日落</button>
				<button id="blog_setting_filter_darkness" type="button" class="blog-setting-filter-btn" filter-name="darkness">暗化</button>
				<button id="blog_setting_filter_grayscale" type="button" class="blog-setting-filter-btn" filter-name="grayscale">灰度</button>
			</div>
		</div>
		<div class="blog-setting-item mb-3">
			<div id="blog_setting_card_radius_to_default" style="cursor: pointer;" tooltip="恢复默认"><i class="fa fa-circle"></i>&nbsp;&nbsp;圆角</div>
			<div style="flex: 1;margin-left: 20px;margin-right: 8px;transform: translateY(2px);">
				<div id="blog_setting_card_radius"></div>
			</div>
		</div>
		
			<div class="blog-setting-item mt-1 mb-3">
				<div style="flex: 1;"><i class="fa fa-eyedropper"></i>&nbsp;&nbsp;主题色</div>
				<div id="theme-color-picker" class="ml-3"></div>
			</div>
		
	</div>
	<button id="fabtn_open_sidebar" class="btn btn-icon btn-neutral fabtn shadow-sm" type="button" style="height: 30px !important;" aria-label="Open Sidebar Menu" tooltip="菜单">
		<span class="btn-inner--icon"><i class="fa fa-bars"></i></span>
	</button>
	
	<button id="fabtn_blog_fps" class="btn btn-icon btn-neutral fabtn shadow-sm" type="button" aria-hidden="true" style="height: 30px !important;" tooltip="博客帧率 (FPS)">
		<div id="fabtn_fps_progress_bar" style="width: 0%;"></div>
		<span>0</span>
	</button>
	
	<button id="fabtn_reading_progress" class="btn btn-icon btn-neutral fabtn shadow-sm" type="button" aria-hidden="true" tooltip="阅读进度">
		<div id="fabtn_reading_progress_bar" style="width: 0%;"></div>
		<span id="fabtn_reading_progress_details">0%</span>
	</button>
</div>

<div id="content" class="site-content">





<div class="page-information-card-container">
	
</div>


<div id="sidebar_mask"></div>
<aside id="leftbar" class="leftbar widget-area" role="complementary">
		

		<div id="leftbar_part1" class="widget widget_search card bg-white shadow-sm border-0">
			<div class="leftbar-banner card-body">
				<span class="leftbar-banner-title text-white">FantasyLand の 暗梦</span>
				<span class="leftbar-banner-subtitle text-white"><i class="fa fa-pencil"></i>&nbsp;&nbsp;人生如戏，故事如诗。</span>
			</div>
                                

			
                                <ul id='leftbar_part1_menu' class='leftbar-menu'>
                                        <li class='leftbar-menu-item'><a href='/'><i class="fa fa-home"></i> 首页</a></li><li class='leftbar-menu-item'><a href='/categories/%E6%8A%80%E6%9C%AF%E5%88%86%E4%BA%AB/'><i class="fa fa-code"></i> 技术分享</a></li><li class='leftbar-menu-item'><a href='/categories/%E5%96%B5%E6%98%9F%E4%BD%BF%E8%80%85%E7%9A%84%E8%87%AA%E6%88%91%E4%BF%AE%E5%85%BB/'><i class="fa fa-book"></i> 喵星使者的自我修养</a></li><li class='leftbar-menu-item'><a href='/categories/%E5%A4%A9%E7%A9%BA%E4%B9%8B%E7%90%B4%E4%B9%90%E8%B0%B1%E5%88%86%E4%BA%AB/'><i class="fa fa-music"></i> 天空之琴乐谱分享</a></li><li class='leftbar-menu-item'><a href='/categories/%E6%9A%97%E6%A2%A6-%E3%81%AE-%E9%9A%8F%E5%BF%83%E8%AF%B4'><i class="fa fa-star"></i> 暗梦&nbsp;の&nbsp;随心说</a></li><li class='leftbar-menu-item'><a target="_blank" rel="noopener" href='https://mygame.anmeng.asia'><i class="fa fa-database"></i> 暗梦&nbsp;の&nbsp;自制游戏库</a></li><li class='leftbar-menu-item'><a href='/archives'><i class="fa fa-archive"></i> 都市看客暗梦&nbsp;の&nbsp;归档</a></li>
                                </ul>
                        
                </div>

                <div id="leftbar_part2" class="widget widget_search card bg-white shadow-sm border-0">
                        <div id="leftbar_part2_inner" class="card-body">
                                
                                
                                        <div class="nav-wrapper" id="sidebar_tab" style="padding-top: 5px;">
                                
                        <ul class="nav nav-pills nav-fill" role="tablist">
                                                
                                                        <li class="nav-item sidebar-tab-switcher" id="post-toc-switcher">
                                                                <a class="active show" id="leftbar_tab_catalog_btn" data-toggle="tab" href="#leftbar_tab_catalog" role="tab" aria-controls="leftbar_tab_catalog" no-pjax><i class="fa fa-th-list"></i>&nbsp;&nbsp;文章目录 </a>
                                                        </li>
                                                
                                                <li class="nav-item sidebar-tab-switcher">
                                                        <a class="" id="leftbar_tab_overview_btn" data-toggle="tab" href="#leftbar_tab_overview" role="tab" aria-controls="leftbar_tab_overview" no-pjax><i class="fa fa-id-card-o"></i>&nbsp;&nbsp;站点概览</a>
                                                </li>
                                                
                                                <li class="nav-item sidebar-tab-switcher">
                                                        <a onclick="$('#leftbar_tab_overview').removeClass('show');$('#leftbar_tab_overview').removeClass('active');" class="" id="leftbar_tab_functions_btn" data-toggle="tab" href="#leftbar_tab_functions" role="tab" aria-controls="leftbar_tab_overview" no-pjax><i class="fa fa-wrench"></i>&nbsp;&nbsp;功能</a>
                                                </li>
                                                
                        </ul>
                                </div>
                                <div>
                                        <div class="tab-content" style="padding: 10px 10px 0 10px;">
                                                
                                                        <div class="tab-pane fade active show" id="leftbar_tab_catalog" role="tabpanel" aria-labelledby="leftbar_tab_catalog_btn">
                                                                <div id="leftbar_catalog"></div>

                                                                <script type="text/javascript">
                                                                        var gened_toc = false;
                                                                        $(function () {
                                                                                $(document).headIndex({
                                                                                        articleWrapSelector: '#post_content',
                                                                                        indexBoxSelector: '#leftbar_catalog',
                                                                                        subItemBoxClass: "index-subItem-box",
                                                                                        itemClass: "index-item",
                                                                                        linkClass: "index-link",
                                                                                        offset: 80,
                                                                                });
                                                                                
                                                                                if(document.getElementById("leftbar_catalog").innerHTML == "")
                                                                                {
											//如果文章没有任何目录的话，则不显示文章目录。
                                                                                        gened_toc = false;
                                                                                        document.getElementById("post-toc-switcher").style.display = "none";
                                                                                        
                                                                                        $("#leftbar_tab_catalog_btn").removeClass("active");
                                                                                        $("#leftbar_tab_catalog_btn").removeClass("show");
                                                                                        $("#leftbar_tab_overview").addClass("active");
                                                                                        $("#leftbar_tab_overview").addClass("show");
                                                                                        $("#leftbar_tab_overview_btn").addClass("active");
                                                                                        $("#leftbar_tab_overview_btn").addClass("show");
											$("#leftbar_tab_overview_btn").attr('Aria-selected','true');
                                                                                }else{
                                                                                        gened_toc = true;
                                                                                }
                                                                        })
                                                                </script>
                                                                
                                                        </div>
                                                

                                                <div class="tab-pane fade text-center" id="leftbar_tab_overview" role="tabpanel" aria-labelledby="leftbar_tab_overview_btn">
							<!-- 站点概览页 -->
                                                        <img id="leftbar_overview_author_image" src="/icon.jpg" class="img-fluid rounded-circle shadow-sm" style="width: 100px;" alt="avatar">
							<h6 id="leftbar_overview_author_name">暗梦先生呀~ </h6>
							<p style="font-size:12px;">一枚众神眷恋的都市看客 & 吟游诗人</p>
							<nav class="site-state">
                                                                <div class="site-state-item site-state-posts">
                                                                        <a href="/archives">
                                                                                <span class="site-state-item-count">
                                                                                
                                                                                52
                                                                                </span>
                                                                                <span class="site-state-item-name">文章</span>
                                                                        </a>
                                                                </div>
								<div class="site-state-item site-state-shuoshuo">
									<a href="/shuoshuo">
                                                                                <span class="site-state-item-count">8</span>
                                                                                <span class="site-state-item-name">说说</span>
                                                                	</a>
								</div>
                                                                <div class="site-state-item site-state-categories">
                                                                        <a data-toggle="modal" data-target="#blog_categories">
                                                                                <span class="site-state-item-count">4</span>
                                                                                <span class="site-state-item-name">分类</span>
                                                                        </a>
                                                                </div>      
                                                                <div class="site-state-item site-state-tags">
                                                                        <a data-toggle="modal" data-target="#blog_tags">
                                                                                <span class="site-state-item-count">14</span>
                                                                                <span class="site-state-item-name">标签</span>
                                                                        </a>
                                                                </div>
                                                        </nav>



                                                        
                                                                        <div class="site-author-links">
                                                                                
                                                                                        <div class='site-author-links-item'>
                                                                                                <a href="tencent://message/?uin=1879857489" rel='noopener' target='_blank'><span style="color:#2196F3;"><i class="fa fa-qq"></i></span></a>
                                                                                                <div class="site-author-links-item-tooltip">QQ</div>
                                                                                        </div>
                                                                                
                                                                                        <div class='site-author-links-item'>
                                                                                                <a href="mailto://dreamstar906@126.com" rel='noopener' target='_blank'><span style="color:#FCB44C;"><i class="fa fa-envelope"></i></span></a>
                                                                                                <div class="site-author-links-item-tooltip">E-mail</div>
                                                                                        </div>
                                                                                
                                                                                        <div class='site-author-links-item'>
                                                                                                <a href="https://github.com/LuminousDream/" rel='noopener' target='_blank'><i class="fa fa-github"></i></a>
                                                                                                <div class="site-author-links-item-tooltip">GitHub</div>
                                                                                        </div>
                                                                                
                                                                                        <div class='site-author-links-item'>
                                                                                                <a href="https://keys.openpgp.org/search?q=4C1B5377CDF813F3E0771E829CC6C2CEC729058D" rel='noopener' target='_blank'><span style="color:#82ABBF;"><i class="fa fa-key"></i></span></a>
                                                                                                <div class="site-author-links-item-tooltip">OpenPGP &amp; GnuPG 公钥</div>
                                                                                        </div>
                                                                                
                                                                                        <div class='site-author-links-item'>
                                                                                                <a href="/atom.xml" rel='noopener' target='_blank'><span style="color:#FF9700;"><i class="fa fa-rss"></i></span></a>
                                                                                                <div class="site-author-links-item-tooltip">RSS</div>
                                                                                        </div>
                                                                                
                                                                                        <div class='site-author-links-item'>
                                                                                                <a href="/atom_shuoshuo.xml" rel='noopener' target='_blank'><span style="color:#F05B85;"><i class="fa fa-rss"></i></span></a>
                                                                                                <div class="site-author-links-item-tooltip">说说 RSS</div>
                                                                                        </div>
                                                                                
                                                                        </div>
                                                                
                                                        
                                                                        <div style="height: 20px;"></div>
                                                                
                                                    </div>

                                                        
                                                        <div class="tab-pane fade" id="leftbar_tab_functions" role="tabpanel" aria-labelledby="leftbar_tab_functions_btn">
								<h6 class="font-weight-bold text-black"><i class="fa fa-clock-o"></i>&nbsp;Time Travel Machine</h6>
									<div id="roman_clock"></div>
                                                                        <script>init_darkdream_roman_clock("#roman_clock");</script>
									<i class="fa fa-calendar-o"></i>&nbsp;<span style="font-size:12px;" id="solar_calendar_label"></span>									<p><i class="fa fa-calendar"></i>&nbsp;<span style="font-size:12px;" id="lunar_calendar_label"></span></p>

									<div class="progress-wrapper" style="padding:0;">
										<div class="progress-info">
											<div class="progress-label">
												<span id="yearprogress_yearname"></span>
											</div>
											<div id="yearprogress_text_container" class="progress-percentage">
												<span id="yearprogress_progresstext">42.34%</span>
												<span id="yearprogress_progresstext_full"></span>
											</div>
										</div>
										<div class="progress">
											<div id="yearprogress_progressbar" class="progress-bar bg-primary" style=""></div>
										</div>
									</div>
									<script>
									var lunar = calendar.solar2lunar();
									var timer_started = false;
									if (timer_started == false) {
									    document.getElementById("solar_calendar_label").innerHTML="公历 "+lunar.cYear+" 年 "+lunar.cMonth+" 月 "+lunar.cDay+" 号 ["+lunar.astro+"]";
									    document.getElementById("lunar_calendar_label").innerHTML="农历 "+lunar.lYear+" ["+lunar.Animal+"] 年 "+lunar.IMonthCn+lunar.IDayCn;
									    timer_started=true;
									}
								</script><br>
								<h6 class="font-weight-bold text-black"><i class="fa fa-pencil"></i>&nbsp;最新文章 & 说说</h6>
								
									
										<p><span class="badge badge-primary" id="shuoshuo_label"><i class="fa fa-quote-left"></i> 说说 </span>&nbsp;<a href="/shuoshuo/87899d1/">心有 “渔” 力不足的都市看客兼吟游诗人</a><br><span class="post_meta_info"><i class="fa fa-clock-o"></i> 2024-8-7</span></p>	
									
								
									
										<p><a href="/bdcdc9f9/">一枚 2024 暑期解谜游戏 · 远坂凛给你的一封祝福信</a><br><span class="post_meta_info"><i class="fa fa-clock-o"></i> 2024-7-6</span></p>	
									
								
									
										<p><span class="badge badge-primary" id="shuoshuo_label"><i class="fa fa-quote-left"></i> 说说 </span>&nbsp;<a href="/shuoshuo/609e4e76/">都市看客暗梦 の 在龙舟之章 · 端午前的随笔</a><br><span class="post_meta_info"><i class="fa fa-clock-o"></i> 2024-6-9</span></p>	
									
								
									
										<p><a href="/cad9d0fd/">Re. 从零开始在 Deta Space 部署 Twikoo 评论系统的过程</a><br><span class="post_meta_info"><i class="fa fa-clock-o"></i> 2024-6-2</span></p>	
									
								
									
										<p><a href="/27fff63c/">「随心说」都市看客暗梦 の 浅谈不应依赖的答案之书</a><br><span class="post_meta_info"><i class="fa fa-clock-o"></i> 2024-5-3</span></p>	
									
								
								<h6 class="font-weight-bold text-black"><i class="fa fa-tags"></i>&nbsp;标签云</h6>	
								<p></p><div class="tagcloud">
								<a class="badge badge-secondary tag" href="/tags/Hackintosh/" rel="tag">Hackintosh <span class="tag-num">3</span></a><a class="badge badge-secondary tag" href="/tags/Hexo/" rel="tag">Hexo <span class="tag-num">3</span></a><a class="badge badge-secondary tag" href="/tags/Linux/" rel="tag">Linux <span class="tag-num">7</span></a><a class="badge badge-secondary tag" href="/tags/MySQL/" rel="tag">MySQL <span class="tag-num">1</span></a><a class="badge badge-secondary tag" href="/tags/Python/" rel="tag">Python <span class="tag-num">2</span></a><a class="badge badge-secondary tag" href="/tags/RPG-MAKER/" rel="tag">RPG MAKER <span class="tag-num">1</span></a><a class="badge badge-secondary tag" href="/tags/Typecho/" rel="tag">Typecho <span class="tag-num">3</span></a><a class="badge badge-secondary tag" href="/tags/WordPress/" rel="tag">WordPress <span class="tag-num">3</span></a><a class="badge badge-secondary tag" href="/tags/%E5%96%B5%E6%98%9F%E4%BA%BA/" rel="tag">喵星人 <span class="tag-num">8</span></a><a class="badge badge-secondary tag" href="/tags/%E6%9A%97%E6%A2%A6%E7%9A%84%E5%A4%A9%E7%A9%BA%E4%B9%8B%E7%90%B4/" rel="tag">暗梦的天空之琴 <span class="tag-num">4</span></a><a class="badge badge-secondary tag" href="/tags/%E6%B2%BB%E6%84%88%E5%BF%83%E7%81%B5/" rel="tag">治愈心灵 <span class="tag-num">10</span></a><a class="badge badge-secondary tag" href="/tags/%E7%94%B5%E5%AD%90%E6%B8%B8%E6%88%8F/" rel="tag">电子游戏 <span class="tag-num">2</span></a><a class="badge badge-secondary tag" href="/tags/%E9%92%A2%E7%90%B4%E7%AE%80%E8%B0%B1/" rel="tag">钢琴简谱 <span class="tag-num">4</span></a><a class="badge badge-secondary tag" href="/tags/%E9%9A%8F%E5%BF%83%E8%AF%B4/" rel="tag">随心说 <span class="tag-num">27</span></a>
								<h6 class="font-weight-bold text-black"><i class="fa fa-info"></i>&nbsp;FantasyLand Status</h6>
								
								
								<label id="blog-post-and-shuoshuo-count">文章 & 说说数目： 52 / 8</label>
								<label id="blog-total-wordcount">博客总字数：64.7k 字</label>
								<label id="blog-last-updated">最近更新时间：2024-08-07</label>

								</div>							
							</div>
                                                        
                                        </div>
                                </div>
                        </div>
                </div>
</aside>



<div class="modal fade" id="blog_categories" tabindex="-1" role="dialog" aria-labelledby="" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
                <div class="modal-content" id="categories_dialog_content">
                        <div class="modal-header">
                                <h5 class="modal-title">分类</h5>
                                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                        <span aria-hidden="true">&times;</span>
                                </button>
                        </div>
                        <div class="modal-body">
                                <a class="badge badge-secondary tag" href="/categories/%E5%96%B5%E6%98%9F%E4%BD%BF%E8%80%85%E7%9A%84%E8%87%AA%E6%88%91%E4%BF%AE%E5%85%BB/" rel="tag">喵星使者的自我修养 <span class="tag-num">8</span></a><a class="badge badge-secondary tag" href="/categories/%E5%A4%A9%E7%A9%BA%E4%B9%8B%E7%90%B4%E4%B9%90%E8%B0%B1%E5%88%86%E4%BA%AB/" rel="tag">天空之琴乐谱分享 <span class="tag-num">4</span></a><a class="badge badge-secondary tag" href="/categories/%E6%8A%80%E6%9C%AF%E5%88%86%E4%BA%AB/" rel="tag">技术分享 <span class="tag-num">22</span></a><a class="badge badge-secondary tag" href="/categories/%E6%9A%97%E6%A2%A6-%E3%81%AE-%E9%9A%8F%E5%BF%83%E8%AF%B4/" rel="tag">暗梦 の 随心说 <span class="tag-num">27</span></a>
                        </div>
                </div>
        </div>
</div>
<div class="modal fade" id="blog_tags" tabindex="-1" role="dialog" aria-labelledby="" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
                <div class="modal-content" id="tagcloud_dialog_content">
                        <div class="modal-header">
                                <h5 class="modal-title">标签</h5>
                                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                        <span aria-hidden="true">&times;</span>
                                </button>
                        </div>
                        <div class="modal-body">
                                <a class="badge badge-secondary tag" href="/tags/Hackintosh/" rel="tag">Hackintosh <span class="tag-num">3</span></a><a class="badge badge-secondary tag" href="/tags/Hexo/" rel="tag">Hexo <span class="tag-num">3</span></a><a class="badge badge-secondary tag" href="/tags/Linux/" rel="tag">Linux <span class="tag-num">7</span></a><a class="badge badge-secondary tag" href="/tags/MySQL/" rel="tag">MySQL <span class="tag-num">1</span></a><a class="badge badge-secondary tag" href="/tags/Python/" rel="tag">Python <span class="tag-num">2</span></a><a class="badge badge-secondary tag" href="/tags/RPG-MAKER/" rel="tag">RPG MAKER <span class="tag-num">1</span></a><a class="badge badge-secondary tag" href="/tags/Typecho/" rel="tag">Typecho <span class="tag-num">3</span></a><a class="badge badge-secondary tag" href="/tags/WordPress/" rel="tag">WordPress <span class="tag-num">3</span></a><a class="badge badge-secondary tag" href="/tags/%E5%96%B5%E6%98%9F%E4%BA%BA/" rel="tag">喵星人 <span class="tag-num">8</span></a><a class="badge badge-secondary tag" href="/tags/%E6%9A%97%E6%A2%A6%E7%9A%84%E5%A4%A9%E7%A9%BA%E4%B9%8B%E7%90%B4/" rel="tag">暗梦的天空之琴 <span class="tag-num">4</span></a><a class="badge badge-secondary tag" href="/tags/%E6%B2%BB%E6%84%88%E5%BF%83%E7%81%B5/" rel="tag">治愈心灵 <span class="tag-num">10</span></a><a class="badge badge-secondary tag" href="/tags/%E7%94%B5%E5%AD%90%E6%B8%B8%E6%88%8F/" rel="tag">电子游戏 <span class="tag-num">2</span></a><a class="badge badge-secondary tag" href="/tags/%E9%92%A2%E7%90%B4%E7%AE%80%E8%B0%B1/" rel="tag">钢琴简谱 <span class="tag-num">4</span></a><a class="badge badge-secondary tag" href="/tags/%E9%9A%8F%E5%BF%83%E8%AF%B4/" rel="tag">随心说 <span class="tag-num">27</span></a>
                        </div>
                </div>
        </div>
</div>


<div id="primary" class="content-area">
	<main id="main" class="site-main article-list article-list-home" role="main">
		
		
			
	
		<article class="post post-full card bg-white shadow-sm border-0 post-preview">
	<header class="post-header text-center">
		
		<a class="post-title" id="post-title"></a>
		<script>
	  		var typed1 = new Typed('#post-title', {
			    "strings":['都市看客暗梦 の 浅谈曾经在 Linux 遇到的 OOM 机制'],"typeSpeed":70,"loop":false,"showCursor":false
			  });
		</script>
		<div class="post-meta">
			<div class="post-meta-detail">
				<i class="fa fa-user" aria-hidden="true"></i> <font>暗梦先生呀~</font> <div class="post-meta-devide">|</div>
			</div>
			
						
						<div class="post-meta-detail post-meta-detail-time">
							<i class="fa fa-clock-o" aria-hidden="true"></i>
							<time id="post_date">2023-10-23
							</time>
						</div>
					
						
							<div class="post-meta-devide">|</div>
						
						<div class="post-meta-detail post-meta-detail-categories">
							<i class="fa fa-bookmark-o" aria-hidden="true"></i>
							<a class="post-meta-detail-catagory-link" href="/categories/%E6%8A%80%E6%9C%AF%E5%88%86%E4%BA%AB/">技术分享</a>
						</div>
					
					
						
							<div class="post-meta-devide">|</div>
						
						<div class="post-meta-detail post-meta-detail-words">
							<i class="fa fa-file-word-o" aria-hidden="true"></i>
							1.8k 字
						</div>
					
						
							<div class="post-meta-devide">|</div>
						
						<div class="post-meta-detail post-meta-detail-readingtime">
							<i class="fa fa-hourglass-end" aria-hidden="true"></i>
							预计阅读时间 7 分钟
						</div>
					
						
                     			
		</div>
		
	</header>

	<div class="post-content" id="post_content">
	    <h3 id="First-前言"><a href="#First-前言" class="headerlink" title="First. 前言"></a>First. 前言</h3><p>Hi，各位旅行者们，你们好，I’m 暗梦，在个人博客的运行过程中，我们有时，或许会出现因为内存不足而造成 OOM 机制<sup> [OOM (Out Of Memory) Killer]</sup>，然而造成这种现象的主要原因嘛，还是来讲暗梦我以前 <em>(Tip: 大概是 2 年前博客还没有迁移到 Github 之前)</em> 在国内的云服务器遇到的：</p>
<ul>
<li>服务器所运行的 MySQL &amp; PHP 占用内存过大，当然，暗梦我也遇到过这样的事儿，我记得当时发现的时候是在下午来着，当时博客打不开，于是折腾了几十分钟才解决问题。</li>
<li>使用 <a target="_blank" rel="noopener" href="https://github.com/cdr/code-server">code-server</a> 在低配服务器进行运维时造成的占用内存过大 <em>(Tip: 毕竟习惯用 VS Code 写代码 &amp; 博客文章啦，不过因为 node 会使用多个进程 &amp; 内存空间，毕竟嘛，暗梦我也不喜欢用宝塔面板之类的 Linux 管理面板，好吧，但事实证明，依旧会如此，所以暗梦我通常都在 SSH 上面完成的运维。)</em></li>
</ul>
<h3 id="I-解决-MySQL-amp-PHP-占用内存过大的问题"><a href="#I-解决-MySQL-amp-PHP-占用内存过大的问题" class="headerlink" title="I. 解决 MySQL &amp; PHP 占用内存过大的问题"></a>I. 解决 MySQL &amp; PHP 占用内存过大的问题</h3><p>首先是第一个问题，暗梦我还是选择修改一下变量 <em>( Tip: em…… ，暗梦我之前在国内的云服务器嘛 ，它的配置是 1核2G1M，不过各位旅行者们可以根据自己云服务器的配置作出修改，可以参考一下 <a target="_blank" rel="noopener" href="https://www.mysqlcalculator.com/">MySQL Memory Calculator</a> 。)</em> 来做一下简单的优化：</p>
<pre class="line-numbers language-ini" data-language="ini"><code class="language-ini"><span class="token key attr-name">max_connections</span> <span class="token punctuation">=</span> <span class="token value attr-value">30 # 限制最大连接数</span>
<span class="token key attr-name">query_cache_size</span> <span class="token punctuation">=</span> <span class="token value attr-value">32M # 限制查询缓存大小，但在 MySQL8.0 却已被弃用。</span>
<span class="token key attr-name">innodb_buffer_pool_size</span><span class="token punctuation">=</span><span class="token value attr-value">268435456 # 限制 InnoDB 缓冲池大小</span>
<span class="token key attr-name">innodb_log_buffer_size</span><span class="token punctuation">=</span><span class="token value attr-value">16777216 # 限制 InnoDB 日志大小</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<p>Oray，接下来是解决 PHP 占用内存过大的问题，修改一下 <code>/etc/php-fpm.d/www.conf</code> 文件：</p>
<pre class="line-numbers language-ini" data-language="ini"><code class="language-ini"><span class="token key attr-name">memory_limit</span><span class="token punctuation">=</span><span class="token value attr-value">128M # 限制最大占用内存大小</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>最后改完之后重启下服务即可。</p>
<h3 id="II-从零开始浅谈-Linux-内核-の-OOM-机制"><a href="#II-从零开始浅谈-Linux-内核-の-OOM-机制" class="headerlink" title="II. 从零开始浅谈 Linux 内核 の OOM 机制"></a>II. 从零开始浅谈 Linux 内核 の OOM 机制</h3><p>这件事儿非常简单，就以 MySQL 说个简单的例子吧：</p>
<blockquote>
<p><strong>暗梦：如果 MySQL 占用的内存过大，Linux 内核检测到物理内存 &amp; 交换分区空间不足，且内存回收失败的情况下，会触发 OOM Killer 终止 MySQL，以此释放内存。</strong></p>
</blockquote>
<p>em……<br>暗梦我还是来讲解一下 OOM Killer 实现的 out_of_memory 函数给旅行者们作为参考吧 <em>(Tip: 也就只是讲一个大概哈 ʕ̢̣·͡˔·ོ )</em> ：</p>
<blockquote>
<p>[root@DarkAce] ~ # <code>cat ~/linux_kernel/mm/oom_kill.c</code></p>
</blockquote>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>

bool <span class="token function">out_of_memory</span><span class="token punctuation">(</span><span class="token keyword">struct</span> <span class="token class-name">oom_control</span> <span class="token operator">*</span>oc<span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
	<span class="token keyword">unsigned</span> <span class="token keyword">long</span> freed <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
  	<span class="token comment">/* 检测是否为冻结的进程，如果是的话则不会触发。 */</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>oom_killer_disabled<span class="token punctuation">)</span>
		<span class="token keyword">return</span> false<span class="token punctuation">;</span>

	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">is_memcg_oom</span><span class="token punctuation">(</span>oc<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
		<span class="token function">blocking_notifier_call_chain</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>oom_notify_list<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>freed<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>freed <span class="token operator">></span> <span class="token number">0</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span><span class="token function">is_sysrq_oom</span><span class="token punctuation">(</span>oc<span class="token punctuation">)</span><span class="token punctuation">)</span>
			<span class="token keyword">return</span> true<span class="token punctuation">;</span>
	<span class="token punctuation">&#125;</span>

   	<span class="token comment">/* 判断是否还有足够的内存以支撑其他应用程序使用 */</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">task_will_free_mem</span><span class="token punctuation">(</span>current<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
		<span class="token function">mark_oom_victim</span><span class="token punctuation">(</span>current<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token function">queue_oom_reaper</span><span class="token punctuation">(</span>current<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">return</span> true<span class="token punctuation">;</span>
	<span class="token punctuation">&#125;</span>

	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token punctuation">(</span>oc<span class="token operator">-></span>gfp_mask <span class="token operator">&amp;</span> __GFP_FS<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span><span class="token function">is_memcg_oom</span><span class="token punctuation">(</span>oc<span class="token punctuation">)</span><span class="token punctuation">)</span>
		<span class="token keyword">return</span> true<span class="token punctuation">;</span>

   <span class="token comment">/*
   * 触发 check_panic_on_oom 函数以判断是选择触发 OOM Killer 还是 Kernel Panic，em......
   * 各位旅行者们可以参考 Linux 内核源代码的文件，暗梦我就不过多讲述了。 
   */</span>
	oc<span class="token operator">-></span>constraint <span class="token operator">=</span> <span class="token function">constrained_alloc</span><span class="token punctuation">(</span>oc<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>oc<span class="token operator">-></span>constraint <span class="token operator">!=</span> CONSTRAINT_MEMORY_POLICY<span class="token punctuation">)</span>
		oc<span class="token operator">-></span>nodemask <span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>
	<span class="token function">check_panic_on_oom</span><span class="token punctuation">(</span>oc<span class="token punctuation">)</span><span class="token punctuation">;</span>

  	<span class="token comment">/* 根据进程的 oom_score_adj 评分触发 OOM Killer，后面暗梦我会讲解哒~ */</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">is_memcg_oom</span><span class="token punctuation">(</span>oc<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> sysctl_oom_kill_allocating_task <span class="token operator">&amp;&amp;</span>
	    current<span class="token operator">-></span>mm <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span><span class="token function">oom_unkillable_task</span><span class="token punctuation">(</span>current<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span>
	    <span class="token function">oom_cpuset_eligible</span><span class="token punctuation">(</span>current<span class="token punctuation">,</span> oc<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span>
	    current<span class="token operator">-></span>signal<span class="token operator">-></span>oom_score_adj <span class="token operator">!=</span> OOM_SCORE_ADJ_MIN<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
		<span class="token function">get_task_struct</span><span class="token punctuation">(</span>current<span class="token punctuation">)</span><span class="token punctuation">;</span>
		oc<span class="token operator">-></span>chosen <span class="token operator">=</span> current<span class="token punctuation">;</span>
		<span class="token function">oom_kill_process</span><span class="token punctuation">(</span>oc<span class="token punctuation">,</span> <span class="token string">"Out of memory (oom_kill_allocating_task)"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">return</span> true<span class="token punctuation">;</span>
	<span class="token punctuation">&#125;</span>

    <span class="token comment">/*
    查找内存占用过大的程序
   */</span>
	<span class="token function">select_bad_process</span><span class="token punctuation">(</span>oc<span class="token punctuation">)</span><span class="token punctuation">;</span>
  	<span class="token comment">/* 如果找不到内存占用过大的程序，且 out_of_memory 并非由 SysRQ 或者内存控制组 (memcg) 触发的嘛，此时内存也表示无可奈何，就会触发内核崩溃，即 Kernel Panic */</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>oc<span class="token operator">-></span>chosen<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
		<span class="token function">dump_header</span><span class="token punctuation">(</span>oc<span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token function">pr_warn</span><span class="token punctuation">(</span><span class="token string">"Out of memory and no killable processes...\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">is_sysrq_oom</span><span class="token punctuation">(</span>oc<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span><span class="token function">is_memcg_oom</span><span class="token punctuation">(</span>oc<span class="token punctuation">)</span><span class="token punctuation">)</span>
			<span class="token function">panic</span><span class="token punctuation">(</span><span class="token string">"System is deadlocked on memory\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">&#125;</span>
  	<span class="token comment">/* em...... 好吧，找到了内存占用过大的程序呢，此时会调用 oom_kill_process 函数终止该程序 */</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>oc<span class="token operator">-></span>chosen <span class="token operator">&amp;&amp;</span> oc<span class="token operator">-></span>chosen <span class="token operator">!=</span> <span class="token punctuation">(</span><span class="token keyword">void</span> <span class="token operator">*</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token number">1UL</span><span class="token punctuation">)</span>
		<span class="token function">oom_kill_process</span><span class="token punctuation">(</span>oc<span class="token punctuation">,</span> <span class="token operator">!</span><span class="token function">is_memcg_oom</span><span class="token punctuation">(</span>oc<span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token string">"Out of memory"</span> <span class="token operator">:</span>
				 <span class="token string">"Memory cgroup out of memory"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">return</span> <span class="token operator">!</span><span class="token operator">!</span>oc<span class="token operator">-></span>chosen<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<blockquote>
<p>em……<br>暗梦: 至于其他的函数实现，各位旅行者可以参考一下 Linux 内核源代码中的 mm/oom_kill.c 文件哈，诶嘿~<br>一般来说，这个 OOM Killer 这种机制一般情况下在内核参数 <code>vm.overcommit_memory = 0</code> &amp; <code>vm.panic_on_oom = 0</code> 是默认开启的，这两个内核函数嘛，都有以下三种情况：</p>
</blockquote>
<div class="admonition shadow-sm admonition-primary"><div class="admonition-title"><i class="fa fa-code"></i>&nbsp;(I). vm.overcommit_memory</div><div class="admonition-body"><ul>
  <li> <code>vm.overcommit_memory = 0</code> (默认值，内核会检测物理内存 & 交换空间是否可供应用程序使用，当如果内存充足的情况下，内存申请成功，反之则申请失败，此时会进行内存回收，但若是内存回收失败，则会直接触发 OOM Killer 终止占用大的程序。)</li>
  <li> <code>vm.overcommit_memory = 1</code> (这种情况下和上述差不多，此时 OOM Killer 也会被触发，但是也有一部分却不会触发 OOM Killer，而是会触发系统重启。)</li>
  <li> <code>vm.overcommit_memory = 2</code> (在这种情况下会始终限制内存，大概的可用内存公式如下： <strong><code>[内存限制大小] = ( [物理内存大小] *  [/proc/sys/vm/overcmmit_ratio] / 100 )+ [交换分区大小]</code></strong> ，如果 mem_limit 已经使用完毕，则后续的内存申请也会失败，换句话说吧，就是没办法再运行新的程序了，但不会触发 OOM Killer ] )</li>
  <blockquote> Tip: 其中 `/proc/sys/vm/overcmmit_ratio` 这里面代表的是系数，默认值为 50，可以根据情况适当修改。</blockquote>
</ul></div></div>

<div class="admonition shadow-sm admonition-info"><div class="admonition-title"><i class="fa fa-code"></i>&nbsp;(II). vm.panic_on_oom</div><div class="admonition-body"><ul>
  <li> <code>vm.panic_on_oom = 0</code> (默认值，通常在内存不足时，会触发 OOM Killer。)</li>
  <li> <code>vm.panic_on_oom = 1</code> (在这种情况下，内存不足时，多数会触发 Kernel Panic ，不过嘛，也有可能仍会触发 OOM Killer)</li>
  <li> <code>vm.panic_on_oom = 2</code> (在这种情况下，若内存不足，则直接触发 Kernel Panic)</li>
</ul></div></div>

<h3 id="III-OOM-机制如何选择-amp-终止内存占用高的程序"><a href="#III-OOM-机制如何选择-amp-终止内存占用高的程序" class="headerlink" title="III. OOM 机制如何选择 &amp; 终止内存占用高的程序"></a>III. OOM 机制如何选择 &amp; 终止内存占用高的程序</h3><p>这个嘛，也就犹如划分好的一个排行榜，好吧。</p>
<blockquote>
<p>[root@DarkAce] ~ # <code>ps</code><br>   PID TTY          TIME CMD<br>…<br>4514 pts/0 0:08.68  hexo<br>…<br>[root@DarkAce] ~ # <code>cat /proc/4514/oom_score_adj</code><br>0</p>
</blockquote>
<p>这个评分也有一定规律，就比方说:</p>
<table>
<thead>
<tr>
<th>总物理内存</th>
<th>实际使用物理内存</th>
<th>oom_score_adj 评分</th>
<th>oom_score_adj 评分说明</th>
</tr>
</thead>
<tbody><tr>
<td>8GB</td>
<td>8GB</td>
<td>1000</td>
<td>最高分，占总内存的 100%，通常在此分数的进程会被 OOM Killer 终止</td>
</tr>
<tr>
<td>8GB</td>
<td>4GB</td>
<td>500</td>
<td>占总内存的 50%</td>
</tr>
<tr>
<td>8GB</td>
<td>&lt; 4GB</td>
<td>0</td>
<td>最低分，通常占总内存的 50% 以下，或者说是更低。</td>
</tr>
</tbody></table>
<p>关于这种评分的规律嘛，有2个因素可以直接联系着 oom_score_adj 评分：</p>
<table>
<thead>
<tr>
<th>因素</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>系统评分</td>
<td>通常会根据上述规律，对 task 所实际占用内存空间的使用情况而评分。</td>
</tr>
<tr>
<td>用户评分</td>
<td>通常可以在 <code>echo  -1000 &gt; /proc/&#123;pid&#125;/oom_score_adj</code> 设置其进程不要被 OOM Killer 终止。</td>
</tr>
</tbody></table>
<h3 id="Last-结语"><a href="#Last-结语" class="headerlink" title="Last. 结语"></a>Last. 结语</h3><p>在这里暗梦我也不希望旅行者们能够太明白，毕竟嘛，有的人可能在服务器搭建的不止博客，还有自己做的个人云网盘之类的，好吧<br><em><strong>但请旅行者们记住，不论博客还是个人云网盘之类的，内容一定要符合法律法规哈，诶嘿~</strong></em></p>
<div class="alert alert-warning"><span class="alert-inner--text"><i class="fa fa-warning"></i>&nbsp;<strong>Tip：</strong>&nbsp;总而言之，在服务器运行的程序不要太多，也要记得定期重启服务器哈，诶嘿~</span></div>
<p>最后祝愿各位旅行者们能够以乐观的心态好好生活，在工作 &amp; 学习中顺利，再会~</p>
<p>　∧＿∧<br> （｡･ω･｡)つ━☆・<em>。<br> ⊂　　 ノ 　　　・゜+.<br>　しーＪ　　　°。+ <em>´¨)<br>　　　 　　 .· ´¸.·</em>´¨) ¸.·</em>¨)<br>　　　　　　　 　(¸.·´ (¸.·’*</p>

	</div>

	

	

	
		<div class="post-tags">
			<i class="fa fa-tags" aria-hidden="true"></i>
			<a class="tag badge badge-secondary post-meta-detail-tag -none-link" href="/tags/Linux/" rel="tag">Linux</a>
		</div>
	
</article>
	
	
<div class="card" id="cc_info">
<br>
<div id="cc_post_title" style="margin-left:20px;"><strong>都市看客暗梦 の 浅谈曾经在 Linux 遇到的 OOM 机制</strong></div>
<div id="cc_post_link" style="margin-left:20px;font-size:14px;"><i class="fa fa-link"></i> <a id="localurl"></a></div>
<div id="cc_post_info" style="margin-left:20px;font-size:14px;"><i class="fa fa-flag"></i> 商业转载请联系作者获得授权，非商业转载请注明出处，转载请注明来自 <a href="/">FantasyLand の 暗梦</a>！</div>

<br>
<table style="margin-left:20px;word-wrap: normal;" id="cc_post_table">
<tr><td style="font-size:14px;"><i class="fa fa-user"></i> 作者</td><td style="font-size:14px;"><i class="fa fa-clock-o"></i> 发布于</td><td style="font-size:14px;"><i class="fa fa-copy"></i> 许可协议</td></tr>
<tr><td>暗梦先生呀~ </td>
<td>2023-10-23</td>
<td><a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" id="cc_link" title="署名-非商业性使用-相同方式共享 4.0 国际 (CC BY-NC-SA 4.0) " ><i class="fa fa-creative-commons"></i> CC BY-NC-SA 4.0</a></td></tr>
</table>
<br>
</div>


<script>
	document.querySelector("#localurl").innerHTML = window.location.href;
	document.querySelector("#localurl").href = window.location.href;
</script>
<br>




	
<div id="post_comment" class="card shadow-sm" style="opacity: 0.87;padding:30px 30px;padding-bottom: 35px;">
<h2 class="comments-title" style="margin-bottom:20px;"><i class="fa fa-comments"></i>评论</h2>
<div class="mdui-progress">
	<div class="mdui-progress-indeterminate mdui-follow-argon-color"></div>
</div>
<div class="post-outdated-info"><i class="fa fa-info-circle" aria-hidden="true"></i>
Tip: 评论前请先查看<a onclick="comment_info();" class="comment_info_button"> 《本站评论特别声明》 </a> ，且所有评论均需审核后才能显示，谢谢~<br>
</div>


		<div id="twikoo_comments"></div>
<script>
  var blog_comment_object = twikoo.init({
				envId: "https://twikoo.anmeng.asia",
  				el: '#twikoo_comments',
  				lang: 'zh-CN',
				onCommentLoaded: function () {
    			document.querySelectorAll('#twikoo a').forEach(function(aEl){
      				if(!aEl.href.startsWith(window.location.origin) && !aEl.href.startsWith("https://anmeng.asia")){
        				aEl.href='/go/?url='+encodeURI(aEl.href.replace(/\/$/, ''));
      				}
    			});
  				}
})
</script>

	</div>



	



<div class="post-navigation card shadow-sm"><div class="post-navigation-item post-navigation-pre"><span style="color:gray;font-size:12px;">Previous</span><span class="page-navigation-extra-text"><i class="fa fa-arrow-circle-o-left" aria-hidden="true"></i>上一篇</span><a href="/60bb5b1a/" rel="prev"> 都市看客暗梦 の 给 Hexo 添加 PWA 支持的新思路</a></div><div class="post-navigation-item post-navigation-next"><span style="color:gray;font-size:12px;">Next</span><span class="page-navigation-extra-text">下一篇 <i class="fa fa-arrow-circle-o-right" aria-hidden="true"></i></span><a href="/2c9586b5/" rel="next"> 「随心说」都市看客暗梦 の 临近凛寒之冬的随笔</a></div></div>





		
		
		
		
					<footer id="footer" class="site-footer card shadow-sm border-0">
						<font id="footer_copyright">CopyRight © 2021 暗梦先生呀~ All Rights Reserved.</font>
						<div>Theme <a target="_blank" rel="noopener" href="https://github.com/solstice23/hexo-theme-argon"><strong>Argon</strong></a> By solstice23 | Powered by <a target="_blank" rel="noopener" href="https://hexo.io"><strong>Hexo</strong></a> | 
							<a onclick='changetime();' id='datetime' style="font-size:15px;" class='serif'>
								</a>
								<a id='fantasy_time_help'></a>
								<script>
								var sw = 0;
								var zqhelp=0;
								</script>
								<script type="text/javascript">
								function time_help()
								{
								switch(zqhelp)
								{
								
								case 0:
								swal("关于鸥历的历法[1/3]","鸥历是在奥利恩斯世界通用的时间\n例如：鸥历842年为公历2011年(因为那是游戏的发布的那一年，剧情全部走完了)\n所以它的元年为1169年\n【另外，鸥历和公历的24小时制(24小时一天)不同，它一天则为12小时制(12小时一天)】","info");
								zqhelp=zqhelp+1;
								break;
								
								case 1:
								swal("关于鸥历的历法[2/3]","鸥历月份换算表：\n1月份  火之月 ｜7月份 土之月\n2月份 水之月｜8月份 岚之月\n3月份 岩之月｜9月份 热之月\n4月份 风之月｜10月份 冷之月\n5月份 炎之月｜11月份 岩之月\n6月份 冰之月｜12月份 空之月","info");
								zqhelp=zqhelp+1;
								break;
								
								case 2:
								swal("关于鸥历的历法[3/3]","\n\n该历法来源于PSP游戏《最终幻想·零式》，如有雷同纯属巧合","info",{buttons: {
								button1:
								{
								text: "Get In RomsFun!",
								value:"get"
								},
								button2:
								{
								text: "了解游戏剧情",
								value:"info"
								},
								button3:
								{
								text: "OK",
								value:"ok"
								},
								
								},}).then(function(value){
								if(value == "get"){
								  window.open("https://romsfun.com/roms/playstation-portable/final-fantasy-reishiki.html");
								}
								else if(value == "info"){
								  window.open("http://www.k73.com/psp/39029.html");
								}
								});
								zqhelp=0;
								break;
								
								}
								
								}
								function changetime()
								{
								if(sw == 0)
								{
								document.getElementById("datetime").innerHTML = pangu.spacing(Fantasy_Now());
								document.getElementById("fantasy_time_help").innerHTML = "<a onclick='time_help();' id='fantasy_time_help' style='font-size:15px;' class='serif'> [说明] </a>";
								sw=1;
								}else
								{
								document.getElementById("datetime").innerHTML = pangu.spacing(Real_Now());
								document.getElementById("fantasy_time_help").innerHTML = "";
								
								sw=0;
								}
								}
								
								document.getElementById("datetime").innerHTML = pangu.spacing(Real_Now());
								document.getElementById("fantasy_time_help").innerHTML = "";

								</script>
						</a>
						</div>

					</footer>
				</main>
			</div>
		</div>

		<script>
		document.body.addEventListener('copy', function (e) {
 		   if (window.getSelection().toString() && window.getSelection().toString().length > 10) {
   		     setClipboardText(e);
  		  }
		}); 

		function setClipboardText(event) {
			var clipboardData = event.clipboardData || window.clipboardData;
			if (clipboardData) {
				event.preventDefault();
				var htmlData = ''
					+ '*-----------------------------------------------------------------------*<br>'
					+ '# 商业转载请联系作者获得授权，非商业转载请注明出处<br>'
					+ '# For commercial use, please contact the author for authorization. For non-commercial use, please indicate the source.<br>'
					+ '# 协议(License)：署名-非商业性使用-相同方式共享 4.0 国际 (CC BY-NC-SA 4.0)<br>'
					+ '# 作者(Author)：暗梦先生呀~ <br>'
					+ '# 链接(URL)：' + window.location.href + '<br>'
					+ '# 来源(Source)： '+ window.location.hostname +' <br>'
					+ '*-----------------------------------------------------------------------*<br><br>'
					+ window.getSelection().toString();
				var textData = ''
					+ '*-----------------------------------------------------------------------*\n'
					+ '# 商业转载请联系作者获得授权，非商业转载请注明出处\n'
					+ '# For commercial use, please contact the author for authorization. For non-commercial use, please indicate the source.\n'
					+ '# 协议(License)：署名-非商业性使用-相同方式共享 4.0 国际 (CC BY-NC-SA 4.0)\n'
					+ '# 作者(Author)：暗梦先生呀~ \n'
					+ '# 链接(URL)：' + window.location.href + '\n'
					+ '# 来源(Source)： '+ window.location.hostname +' \n'
					+ '*-----------------------------------------------------------------------*\n\n'
					+ window.getSelection().toString();
				  clipboardData.setData('text/html', htmlData);
				  clipboardData.setData('text/plain',textData);
				  mdui.snackbar({message: '<strong>Copied!</strong><br><i>tip:请尊重原创文章，非商业转载请注明出处。</i><br>作者(Author)：暗梦先生呀~ ',position: 'right-top'});
			}
		}

		if (window.location.hostname === "anmeng.eu.org") {
		  checkblogpush_and_print_lastmessage();
		}
		
		</script>
		
<script src="/argontheme.js"></script>

		
		
		

		
			<script>
				var argonEnableCodeHighlight = true;
			</script>
			
<link rel="stylesheet" href="/assets/vendor/highlight/styles/vs2015_anmeng.css">

		

	</div>
</div>
<noscript>
	<style>
		article img.lazyload[src^="data:image/svg+xml;base64,PCEtLUFyZ29uTG9hZGluZy0tPg"]{display: none;}
		.comment-item-text .comment-sticker.lazyload{display: none;}
	</style>
</noscript>
</body>





<div class="blog_musicbox_control no-pjax" style="z-index:100000;position:relative;">
<div id="aplayer" class="blog_musicbox no-pjax hidden" style="display:none;"></div>
</div>

<script no-pjax>
try {
var metingapi_url="https://api.injahow.cn/meting/?server=netease&type=song&id=";
var songid_data = ['531253053','687506','33682739','22636640','447303772','1942909267','1404596131','520242026','29017078','34613438','1928521973','1458664808','1915699293','1915700989','191252','537787665','1500439504']

const ap = new APlayer({
    container: document.getElementById('aplayer'),
	fixed: false,
	lrcType: 3,
	order: 'list',
	preload: 'none',
	theme: '#F05B85',
	listFolded: true
});

songid_data.forEach((item) => {
fetch(metingapi_url+item)
  .then(function(response) {
      var temp_songdata = [];
      temp_songdata.push(response.json())
      Promise.all(temp_songdata).then(function(results) {
      for (i = 0 ;i < results.length;i++)
	{
	    ap.list.add({
   	      name: results[i][0].name,
   	      artist: results[i][0].artist,
  	      url: results[i][0].url,
   	      cover: results[i][0].pic,
   	      lrc: results[i][0].lrc,
	      theme: '#ebd0c2'
	    });
	}
    });
  })
});

if ($("#float_action_buttons").hasClass("fabtns-float-left")){
	$("#aplayer").addClass("align-left");
}
$("#aplayer").addClass("mdui-shadow-6");
}catch(err){}
</script>

</html>
<!-- 随机文章功能 -->
             <script>
              var posts=["3d8e3836/","29682406/","6c7cded/","583256b2/","4dfc8d36/","80a705f8/","9edfc8c7/","c3464ddc/","f9910d43/","3c3f650c/","6958ef11/","3b42a900/","efdb30fe/","81c40aed/","5d5eb4fd/","2493498c/","d5bff76b/","3da5ba11/","9f498195/","9a15a626/","cad9d0fd/","78c6ea47/","fa038589/","41b04205/","b7b7087/","27fff63c/","536096c0/","12ebe1b0/","2c9586b5/","c34131c8/","60bb5b1a/","bdcdc9f9/","740c95d7/","c1e42d95/","153650c/","ed2ab52c/","8020d73a/","db0daa9f/","536e38d0/","29a55fff/","be102642/","83a98f88/","9e353a30/","e1cfb062/","42cc5bb9/","9a107844/","7f22a087/","3f5e9913/","afea83d/","5132bf84/","8f034b5/","1d7969b6/"];
	      posts.splice(posts.indexOf(/shuoshuo/g),1)
             function toRandomPost() {
               $.pjax({
         　　    url: '/'+posts[Math.floor(Math.random() * posts.length)]
                })
              }</script>
    